{% extends "_base.html" %}

{% block content %}
<section class="page-title bg-1">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="block text-center">
          <h1 class="text-capitalize mb-4 text-lg">{{ book.title }}</h1>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="{% url 'core:home' %}" class="text-white">Home</a></li>
            <li class="list-inline-item"><span class="text-white">/</span></li>
            <li class="list-inline-item"><a href="#" class="text-white-50">{{ book.title }}</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section blog-wrap bg-gray">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-lg-12 mb-5">
                        <div class="single-blog-item">
                            <!-- Book cover image -->
                            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="img-fluid rounded">

                            <div class="blog-item-content bg-white p-5">
                                <div class="blog-item-meta bg-gray py-1 px-2">
                                    <span class="text-muted text-capitalize mr-3"><i class="ti-pencil-alt mr-2"></i>{{ book.added_by }}</span>
                                    <span class="text-black text-capitalize mr-3"><i class="ti-time mr-1"></i> Added at {{ book.jcreated_at }}</span>
                                </div> 

                                <h2 class="mt-3 mb-4">{{ book.title }}</h2>
                                <p>{{ book.desc }}</p>

                                <div class="tag-option mt-5 clearfix">
                                    <ul class="float-left list-inline"> 
                                        <li>Category:</li> 
                                        {% for cat in book.categories.all %}
                                        <li class="list-inline-item"><a href="#" rel="tag">{{ cat.name }}</a></li>
                                        {% endfor %}
                                    </ul>        
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comments Section -->
                    <div class="col-lg-12 mb-5">
                      <div class="comment-area card border-0 p-5">
                        <h4 class="mb-4">{{ book.comments.count }} Comment{{ book.comments.count|pluralize }}</h4>
                        <ul class="comment-tree list-unstyled">
                          {% for comment in book.comments.all %}
                            <li class="mb-5">
                              <div class="comment-area-box">
                                <img alt="" src="{{ comment.user.profile_pic.url|default:'/static/images/default-avatar.png' }}" 
                                     class="img-fluid float-left mr-3 mt-2" width="60">

                                <h5 class="mb-1">{{ comment.user.get_full_name|default:comment.user.username }}</h5>
                                <span>{{ comment.user.email }}</span>

                                <div class="comment-meta mt-4 mt-lg-0 mt-md-0 float-lg-right float-md-right">
                                  <span class="date-comm">Posted {{ comment.created_at|date:"F j, Y" }}</span>
                                </div>

                                <div class="comment-content mt-3">
                                  <p>{{ comment.content }}</p>
                                </div>
                              </div>
                            </li>
                          {% empty %}
                            <p>No comments yet. Be the first to comment!</p>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>

                    <!-- Comment Form -->
                    <div class="col-lg-12">
                      <form method="post" class="contact-form bg-white rounded p-5">
                        {% csrf_token %}
                        <h4 class="mb-4">Write a comment</h4>

                        {{ form.non_field_errors }}

                        <div class="form-group">
                          {{ form.content }}
                          {{ form.content.errors }}
                        </div>

                        <button type="submit" class="btn btn-main btn-round-full">Submit Comment</button>
                      </form>
                    </div>
                </div>
            </div>

            <!-- Sidebar with Borrow Section -->
            <div class="col-lg-4">
                <div class="sidebar-wrap">

                    <!-- Borrow Book Widget -->
                    <div class="sidebar-widget card border-0 mb-3 p-4 text-center">
                        <h5>Borrow This Book</h5>
                        {% if user.is_authenticated %}
                          {% if book.is_borrowed %}
                            <p class="text-danger">This book is borrowed by another user</p>
                          {% else %}
                            <p class="text-success">This book is available to borrow</p>
                            <form method="post" action="{% url 'books:borrow-book' book.pk %}">
                              {% csrf_token %}
                              <button type="submit" class="btn btn-primary">Borrow Book</button>
                            </form>
                          {% endif %}
                        {% else %}
                          <p><a href="{% url 'accounts:login' %}">Login</a> to borrow this book</p>
                        {% endif %}
                    </div>

                </div>
            </div>   
        </div>
    </div>
</section>
{% endblock content %}
